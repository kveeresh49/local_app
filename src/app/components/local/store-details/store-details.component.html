<app-top-search-nav-bar></app-top-search-nav-bar>

<div #storeDetails class="d-flex position-sticky store-details">
  <div class="store-description">
    <img src="../../assets/images/store-images/back-arrow.png" alt="Back" />
    <div class="store-content">
      <h3 class="text-white">Bhabji Sabji</h3>
      <div class="text-white mt-1">Vegetables, Fruits, Greens</div>
      <div class="text-white mt-1">
        East Maredpally, Secunderabad, Hyderabad
      </div>
      <div class="text-white mt-1">Open now - 9am - 9pm</div>
      <div class="d-flex align-items-center mt-2 store-rating-container">
        <div class="store-rating">4.5</div>
        <div style="font-size: 10px" class="mx-1">
          <i class="fa-solid fa-star"></i>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- TODO: Need to remove inline styles -->

<div class="container-fluid" style="padding-left: 0">
  <div class="row">
    <div style="width: 350px; margin-top: 3.5rem">
      <div
        class="card text-end"
        style="
          border: 1px solid #e7e7e7;
          border-radius: 0;
          border-bottom: 0;
          box-shadow: 0px 0px 1px rgb(0 0 0 / 12%);
        "
      >
        <div class="card-body">
          <span style="font-weight: 700">Today's Deals</span>
        </div>
      </div>
      <div
        class="card text-end"
        style="
          border: 1px solid #e7e7e7;
          border-radius: 0;
          height: 250px;
          box-shadow: 0px 0px 1px rgb(0 0 0 / 12%);
        "
      >
        <div class="card-body" style="padding-right: 0">
          <div style="font-weight: 700; padding-right: 20px">Categories</div>
          <div
            *ngFor="let item of categories"
            style="padding-right: 20px"
            class="mt-2 cursor-pointer"
            [class.selected-category]="selectedCategoryId === item.id"
            [ngStyle]="{
              color: selectedCategoryId === item.id ? '#5BB600' : '#929292'
            }"
            (click)="onSelectCategory(item.id)"
          >
            {{ item.name }}
          </div>
        </div>
      </div>
    </div>
    <div class="col-6" style="height: 1000px">
      <div class="row">
        <div class="col-8">
          <div
            class="d-flex mt-4"
            style="
              padding-bottom: 8px;
              justify-content: space-around;
              align-items: center;
            "
          >
            <span
              *ngFor="let item of storeNavItems"
              class="cursor-pointer"
              [class.selected-nav-item]="selectedStoreNavId === item.id"
              [ngStyle]="{
                color: selectedStoreNavId === item.id ? '#5BB600' : '#929292'
              }"
              (click)="onSelectNavItem(item.id)"
              >{{ item.name }}</span
            >
          </div>
        </div>
        <div class="col-4">
          <input class="form-control mt-2" placeholder="Search for Products" />
        </div>
        <span style="border-top: 1px solid #e7e7e7"></span>
      </div>
      <div
        style="
          margin: 30px 0 0 30px;
          display: flex;
          width: 700px;
          gap: 50px;
          flex-wrap: wrap;
        "
      >
        <div *ngFor="let product of products" class="products">
          <div
            class="flex"
            style="justify-content: space-between; height: 77px"
          >
            <div>
              <div *ngIf="product?.discount" class="offer-tag">
                <div class="offer-text">
                  <div>{{ product.discount }} %</div>
                  <div class="me-2">Off</div>
                </div>
              </div>
            </div>
            <div style="margin: 10px 10px 0 0">
              <i class="fa-solid fa-heart heart-color"></i>
            </div>
          </div>
          <div style="width: 80px; height: 80px; margin: auto">
            <img
              [src]="product.image"
              width="80px"
              height="80px"
              alt="Coriander"
            />
          </div>
          <div class="item-name">{{ product.name }}</div>
          <div class="item-weight">{{ product.quantity }}</div>
          <div class="flex" style="justify-content: space-between">
            <div>
              <div class="item-price mt-2">₹{{ product.price }}</div>
              <div *ngIf="product.oldPrice" class="item-old-price">
                <del>₹{{ product.oldPrice }}</del>
              </div>
            </div>
            <div *ngIf="product.count === 0" class="add-item cursor-pointer">
              <div
                class="add-item-text"
                (click)="updateCount(product.id, true)"
              >
                Add +
              </div>
            </div>
            <div *ngIf="product.count !== 0" class="added-to-cart">
              <span
                class="increment-decrement cursor-pointer"
                (click)="updateCount(product.id, false)"
                >-</span
              >
              <span
                style="
                  color: #5bb600;
                  width: 35px;
                  text-align: center;
                  width: 35px;
                  text-align: center;
                "
                >{{ product.count }}</span
              >
              <span
                class="increment-decrement cursor-pointer"
                (click)="updateCount(product.id, true)"
                >+</span
              >
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-3 mt-3">
      <div class="d-flex flex-column" style="gap: 20px">
        <div class="card">
          <div class="card-body">Offers goes here.</div>
        </div>
        <div *ngIf="!cart.length; else elseTemplate">
          <img width="100%" src="assets/images/cart-empty.png" />
        </div>
        <ng-template #elseTemplate>
          <ng-container
            *ngTemplateOutlet="cartTemplate; context: { $implicit: cart }"
          ></ng-container>
        </ng-template>
      </div>
    </div>
  </div>
  <hr />
</div>

<ng-template #cartTemplate let-product>
  <div class="card text-center">
    <h6 class="card-header" style="background-color: #eff8e5; color: #5bb600">
      Items from Bhabji Sabji
    </h6>
    <div class="card-body">
      <div *ngFor="let item of cart">
        <div class="flex mt-3">
          <div class="w-50">
            <div class="item-name" style="font-size: 14px; text-align: left">
              {{ item.name }}
            </div>
            <div class="item-weight" style="font-size: 12px; text-align: left">
              {{ item.quantity }}
            </div>
          </div>
          <div class="flex mt-1 w-25" style="height: 18px; font-size: 12px">
            <span
              (click)="updateCount(item.id, false)"
              class="increment-decrement cursor-pointer"
              >-</span
            >
            <span style="color: #5bb600; width: 35px; text-align: center">{{
              item.count
            }}</span>
            <span
              (click)="updateCount(item.id, true)"
              class="increment-decrement cursor-pointer"
              >+</span
            >
          </div>
          <div class="w-25">
            <div class="item-price" style="font-size: 14px">
              ${{ item.price }}
            </div>
            <div
              *ngIf="item.oldPrice"
              class="item-old-price"
              style="font-size: 12px"
            >
              <del>${{ item.oldPrice }}</del>
            </div>
          </div>
        </div>
        <hr />
      </div>
      <div class="flex">
        <div class="w-50">
          <div class="item-name" style="font-size: 14px; text-align: left">
            Subtotal
          </div>
          <div class="item-weight" style="font-size: 10px; text-align: left">
            Extra Charges may apply
          </div>
        </div>
        <div class="w-25"></div>
        <div class="item-price w-25" style="font-size: 14px">
          ₹{{ cartTotal }}
        </div>
      </div>
      <div class="w-100 checkout-box cursor-pointer mt-3" style="height: 35px">
        <div style="font-size: larger">Checkout</div>
      </div>
    </div>
  </div>
</ng-template>
